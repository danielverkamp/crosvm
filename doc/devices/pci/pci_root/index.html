<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="API documentation for the Rust `pci_root` mod in crate `devices`."><meta name="keywords" content="rust, rustlang, rust-lang, pci_root"><title>devices::pci::pci_root - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../SourceSerif4-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../FiraSans-Regular.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../FiraSans-Medium.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../SourceCodePro-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../SourceSerif4-Bold.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../SourceCodePro-Semibold.ttf.woff2"><link rel="stylesheet" type="text/css" href="../../../normalize.css"><link rel="stylesheet" type="text/css" href="../../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../../../ayu.css" disabled><link rel="stylesheet" type="text/css" href="../../../dark.css" disabled><link rel="stylesheet" type="text/css" href="../../../light.css" id="themeStyle"><script id="default-settings" ></script><script src="../../../storage.js"></script><script src="../../../crates.js"></script><script defer src="../../../main.js"></script>
    <noscript><link rel="stylesheet" href="../../../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../../../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../../../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../../../favicon.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="sidebar-logo" href="../../../devices/index.html"><div class="logo-container"><img class="rust-logo" src="../../../rust-logo.svg" alt="logo"></div>
        </a><h2 class="location"></h2>
    </nav>
    <nav class="sidebar"><a class="sidebar-logo" href="../../../devices/index.html"><div class="logo-container"><img class="rust-logo" src="../../../rust-logo.svg" alt="logo"></div>
        </a><h2 class="location"><a href="#">Module pci_root</a></h2><div class="sidebar-elems"><section><div class="block"><ul><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#constants">Constants</a></li></ul></div></section><div id="sidebar-vars" data-name="pci_root" data-ty="mod" data-relpath="./"></div><script defer src="./sidebar-items.js"></script></div></nav><main><div class="width-limiter"><div class="sub-container"><a class="sub-logo-container" href="../../../devices/index.html"><img class="rust-logo" src="../../../rust-logo.svg" alt="logo"></a><nav class="sub"><div class="theme-picker hidden"><button id="theme-picker" aria-label="Pick another theme!" aria-haspopup="menu" title="themes"><img width="22" height="22" alt="Pick another theme!" src="../../../brush.svg"></button><div id="theme-choices" role="menu"></div></div><form class="search-form"><div class="search-container"><span></span><input class="search-input" name="search" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><button type="button" id="help-button" title="help">?</button><a id="settings-menu" href="../../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../../wheel.svg"></a></div></form></nav></div><section id="main-content" class="content"><div class="main-heading">
    <h1 class="fqn"><span class="in-band">Module <a href="../../index.html">devices</a>::<wbr><a href="../index.html">pci</a>::<wbr><a class="mod" href="#">pci_root</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../../../clipboard.svg" width="19" height="18" alt="Copy item path"></button></span></h1><span class="out-of-band"><a class="srclink" href="../../../src/devices/pci/pci_root.rs.html#5-569">source</a> · <a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span></div><h2 id="structs" class="small-section-header"><a href="#structs">Structs</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.PciConfigIo.html" title="devices::pci::pci_root::PciConfigIo struct">PciConfigIo</a></div><div class="item-right docblock-short"><p>Emulates PCI configuration access mechanism #1 (I/O ports 0xcf8 and 0xcfc).</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.PciConfigMmio.html" title="devices::pci::pci_root::PciConfigMmio struct">PciConfigMmio</a></div><div class="item-right docblock-short"><p>Emulates PCI memory-mapped configuration access mechanism.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.PciRoot.html" title="devices::pci::pci_root::PciRoot struct">PciRoot</a></div><div class="item-right docblock-short"><p>Emulates the PCI Root bridge.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.PciRootConfiguration.html" title="devices::pci::pci_root::PciRootConfiguration struct">PciRootConfiguration</a></div><div class="item-right docblock-short"></div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.PciVirtualConfigMmio.html" title="devices::pci::pci_root::PciVirtualConfigMmio struct">PciVirtualConfigMmio</a></div><div class="item-right docblock-short"><p>Inspired by PCI configuration space, CrosVM provides 2048 dword virtual registers (8KiB in
total) for each PCI device. The guest can use these registers to exchange device-specific
information with CrosVM. The first 4kB is trapped by crosvm and crosm supply these
register’s emulation. The second 4KB is mapped into guest directly as shared memory, so
when guest access this 4KB, vm exit doesn’t happen.
All these virtual registers from all PCI devices locate in a contiguous memory region.
The base address of this memory region is provided by an IntObj named VCFG in the ACPI DSDT.
Bit 12 is used to select the first trapped page or the second directly mapped page
The offset of each register is calculated in the same way as PCIe ECAM;
i.e. offset = (bus &lt;&lt; 21) | (device &lt;&lt; 16) | (function &lt;&lt; 13) | (page_select &lt;&lt; 12) |
(register_index &lt;&lt; 2)</p>
</div></div></div><h2 id="enums" class="small-section-header"><a href="#enums">Enums</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.PciRootCommand.html" title="devices::pci::pci_root::PciRootCommand enum">PciRootCommand</a></div><div class="item-right docblock-short"></div></div></div><h2 id="constants" class="small-section-header"><a href="#constants">Constants</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.PCIE_XBAR_BASE_ADDR.html" title="devices::pci::pci_root::PCIE_XBAR_BASE_ADDR constant">PCIE_XBAR_BASE_ADDR</a></div><div class="item-right docblock-short"></div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.PCI_DEVICE_ID_INTEL_82441.html" title="devices::pci::pci_root::PCI_DEVICE_ID_INTEL_82441 constant">PCI_DEVICE_ID_INTEL_82441</a></div><div class="item-right docblock-short"></div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.PCI_RESET_CPU_BIT.html" title="devices::pci::pci_root::PCI_RESET_CPU_BIT constant">PCI_RESET_CPU_BIT</a></div><div class="item-right docblock-short"></div></div></div></section><section id="search" class="content hidden"></section></div></main><div id="rustdoc-vars" data-root-path="../../../" data-current-crate="devices" data-themes="ayu,dark,light" data-resource-suffix="" data-rustdoc-version="1.60.0 (7737e0b5c 2022-04-04)" ></div>
</body></html>
<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Trait that the platform-specific type `VhostUserListener` needs to implement. It contains all the methods that are ok to call from non-platform specific code."><meta name="keywords" content="rust, rustlang, rust-lang, VhostUserListenerTrait"><title>VhostUserListenerTrait in devices::virtio::vhost::user::device::listener - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../../../SourceSerif4-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../../../FiraSans-Regular.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../../../FiraSans-Medium.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../../../SourceCodePro-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../../../SourceSerif4-Bold.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../../../SourceCodePro-Semibold.ttf.woff2"><link rel="stylesheet" type="text/css" href="../../../../../../normalize.css"><link rel="stylesheet" type="text/css" href="../../../../../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../../../../../../ayu.css" disabled><link rel="stylesheet" type="text/css" href="../../../../../../dark.css" disabled><link rel="stylesheet" type="text/css" href="../../../../../../light.css" id="themeStyle"><script id="default-settings" ></script><script src="../../../../../../storage.js"></script><script src="../../../../../../crates.js"></script><script defer src="../../../../../../main.js"></script>
    <noscript><link rel="stylesheet" href="../../../../../../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../../../../../../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../../../../../../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../../../../../../favicon.svg"></head><body class="rustdoc trait"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="sidebar-logo" href="../../../../../../devices/index.html"><div class="logo-container"><img class="rust-logo" src="../../../../../../rust-logo.svg" alt="logo"></div>
        </a><h2 class="location"></h2>
    </nav>
    <nav class="sidebar"><a class="sidebar-logo" href="../../../../../../devices/index.html"><div class="logo-container"><img class="rust-logo" src="../../../../../../rust-logo.svg" alt="logo"></div>
        </a><h2 class="location"><a href="#">VhostUserListenerTrait</a></h2><div class="sidebar-elems"><section><div class="block"><h3 class="sidebar-title"><a href="#required-methods">Required Methods</a></h3><ul><li><a href="#tymethod.new">new</a></li><li><a href="#tymethod.run_backend">run_backend</a></li></ul></div><div class="block"><h3 class="sidebar-title"><a href="#provided-methods">Provided Methods</a></h3><ul><li><a href="#method.run_device">run_device</a></li><li><a href="#method.take_parent_process_resources">take_parent_process_resources</a></li></ul></div><div class="block"><h3 class="sidebar-title"><a href="#implementors">Implementors</a></h3></div></section><h2 class="location"><a href="index.html">In devices::virtio::vhost::user::device::listener</a></h2><div id="sidebar-vars" data-name="VhostUserListenerTrait" data-ty="trait" data-relpath=""></div><script defer src="sidebar-items.js"></script></div></nav><main><div class="width-limiter"><div class="sub-container"><a class="sub-logo-container" href="../../../../../../devices/index.html"><img class="rust-logo" src="../../../../../../rust-logo.svg" alt="logo"></a><nav class="sub"><div class="theme-picker hidden"><button id="theme-picker" aria-label="Pick another theme!" aria-haspopup="menu" title="themes"><img width="22" height="22" alt="Pick another theme!" src="../../../../../../brush.svg"></button><div id="theme-choices" role="menu"></div></div><form class="search-form"><div class="search-container"><span></span><input class="search-input" name="search" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><button type="button" id="help-button" title="help">?</button><a id="settings-menu" href="../../../../../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../../../../../wheel.svg"></a></div></form></nav></div><section id="main-content" class="content"><div class="main-heading">
    <h1 class="fqn"><span class="in-band">Trait <a href="../../../../../index.html">devices</a>::<wbr><a href="../../../../index.html">virtio</a>::<wbr><a href="../../../index.html">vhost</a>::<wbr><a href="../../index.html">user</a>::<wbr><a href="../index.html">device</a>::<wbr><a href="index.html">listener</a>::<wbr><a class="trait" href="#">VhostUserListenerTrait</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../../../../../../clipboard.svg" width="19" height="18" alt="Copy item path"></button></span></h1><span class="out-of-band"><a class="srclink" href="../../../../../../src/devices/virtio/vhost/user/device/listener.rs.html#19-69">source</a> · <a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span></div><div class="docblock item-decl"><pre class="rust trait"><code>pub trait VhostUserListenerTrait {
    fn <a href="#tymethod.new" class="fnname">new</a>(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;path: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.60.0/std/primitive.str.html">str</a>, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;max_num_queues: <a class="primitive" href="https://doc.rust-lang.org/1.60.0/std/primitive.usize.html">usize</a>, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;keep_rds: <a class="enum" href="https://doc.rust-lang.org/1.60.0/core/option/enum.Option.html" title="enum core::option::Option">Option</a>&lt;&amp;mut <a class="struct" href="https://doc.rust-lang.org/1.60.0/alloc/vec/struct.Vec.html" title="struct alloc::vec::Vec">Vec</a>&lt;<a class="type" href="../../../../../../base/sys/unix/descriptor/type.RawDescriptor.html" title="type base::sys::unix::descriptor::RawDescriptor">RawDescriptor</a>&gt;&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;) -&gt; <a class="type" href="https://docs.rs/anyhow/1.0.58/anyhow/type.Result.html" title="type anyhow::Result">Result</a>&lt;<a class="enum" href="sys/unix/enum.VhostUserListener.html" title="enum devices::virtio::vhost::user::device::listener::sys::unix::VhostUserListener">VhostUserListener</a>&gt;;
<div class="item-spacer"></div>    fn <a href="#tymethod.run_backend" class="fnname">run_backend</a>(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;backend: <a class="struct" href="https://doc.rust-lang.org/1.60.0/alloc/boxed/struct.Box.html" title="struct alloc::boxed::Box">Box</a>&lt;dyn <a class="trait" href="../handler/trait.VhostUserBackend.html" title="trait devices::virtio::vhost::user::device::handler::VhostUserBackend">VhostUserBackend</a>&gt;, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ex: &amp;<a class="enum" href="../../../../../../cros_async/sys/unix/executor/enum.Executor.html" title="enum cros_async::sys::unix::executor::Executor">Executor</a><br>&nbsp;&nbsp;&nbsp;&nbsp;) -&gt; <a class="struct" href="https://doc.rust-lang.org/1.60.0/core/pin/struct.Pin.html" title="struct core::pin::Pin">Pin</a>&lt;<a class="struct" href="https://doc.rust-lang.org/1.60.0/alloc/boxed/struct.Box.html" title="struct alloc::boxed::Box">Box</a>&lt;dyn <a class="trait" href="https://doc.rust-lang.org/1.60.0/core/future/future/trait.Future.html" title="trait core::future::future::Future">Future</a>&lt;Output = <a class="type" href="https://docs.rs/anyhow/1.0.58/anyhow/type.Result.html" title="type anyhow::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.60.0/std/primitive.unit.html">()</a>&gt;&gt;&gt;&gt;;

    fn <a href="#method.take_parent_process_resources" class="fnname">take_parent_process_resources</a>(&amp;mut self) -&gt; <a class="enum" href="https://doc.rust-lang.org/1.60.0/core/option/enum.Option.html" title="enum core::option::Option">Option</a>&lt;<a class="struct" href="https://doc.rust-lang.org/1.60.0/alloc/boxed/struct.Box.html" title="struct alloc::boxed::Box">Box</a>&lt;dyn <a class="trait" href="https://doc.rust-lang.org/1.60.0/core/any/trait.Any.html" title="trait core::any::Any">Any</a>&gt;&gt; { ... }
<div class="item-spacer"></div>    fn <a href="#method.run_device" class="fnname">run_device</a>(self, device: <a class="struct" href="https://doc.rust-lang.org/1.60.0/alloc/boxed/struct.Box.html" title="struct alloc::boxed::Box">Box</a>&lt;dyn <a class="trait" href="../trait.VhostUserDevice.html" title="trait devices::virtio::vhost::user::device::VhostUserDevice">VhostUserDevice</a>&gt;) -&gt; <a class="type" href="https://docs.rs/anyhow/1.0.58/anyhow/type.Result.html" title="type anyhow::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.60.0/std/primitive.unit.html">()</a>&gt;<br>&nbsp;&nbsp;&nbsp; <span class="where">where<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Self: <a class="trait" href="https://doc.rust-lang.org/1.60.0/core/marker/trait.Sized.html" title="trait core::marker::Sized">Sized</a></span>,
    { ... }
}</code></pre></div><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Trait that the platform-specific type <code>VhostUserListener</code> needs to implement. It contains all
the methods that are ok to call from non-platform specific code.</p>
</div></details><h2 id="required-methods" class="small-section-header">Required methods<a href="#required-methods" class="anchor"></a></h2><div class="methods"><details class="rustdoc-toggle" open><summary><div id="tymethod.new" class="method has-srclink"><div class="rightside"><a class="srclink" href="../../../../../../src/devices/virtio/vhost/user/device/listener.rs.html#26-30">source</a></div><h4 class="code-header">fn <a href="#tymethod.new" class="fnname">new</a>(<br>&nbsp;&nbsp;&nbsp;&nbsp;path: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.60.0/std/primitive.str.html">str</a>, <br>&nbsp;&nbsp;&nbsp;&nbsp;max_num_queues: <a class="primitive" href="https://doc.rust-lang.org/1.60.0/std/primitive.usize.html">usize</a>, <br>&nbsp;&nbsp;&nbsp;&nbsp;keep_rds: <a class="enum" href="https://doc.rust-lang.org/1.60.0/core/option/enum.Option.html" title="enum core::option::Option">Option</a>&lt;&amp;mut <a class="struct" href="https://doc.rust-lang.org/1.60.0/alloc/vec/struct.Vec.html" title="struct alloc::vec::Vec">Vec</a>&lt;<a class="type" href="../../../../../../base/sys/unix/descriptor/type.RawDescriptor.html" title="type base::sys::unix::descriptor::RawDescriptor">RawDescriptor</a>&gt;&gt;<br>) -&gt; <a class="type" href="https://docs.rs/anyhow/1.0.58/anyhow/type.Result.html" title="type anyhow::Result">Result</a>&lt;<a class="enum" href="sys/unix/enum.VhostUserListener.html" title="enum devices::virtio::vhost::user::device::listener::sys::unix::VhostUserListener">VhostUserListener</a>&gt;</h4></div></summary><div class="docblock"><p>Creates a VhostUserListener from <code>path</code>, which is a platform-specific string describing how
to establish the vhost-user channel. For instance, it can be a path to a socket.</p>
<p><code>max_num_queues</code> is the maximum number of queues we will supports through this channel.
<code>keep_rds</code> is a vector of <code>RawDescriptor</code>s to which the descriptors needed for this listener
to operate properly will be added if it is <code>Some()</code>.</p>
</div></details><details class="rustdoc-toggle" open><summary><div id="tymethod.run_backend" class="method has-srclink"><div class="rightside"><a class="srclink" href="../../../../../../src/devices/virtio/vhost/user/device/listener.rs.html#52-56">source</a></div><h4 class="code-header">fn <a href="#tymethod.run_backend" class="fnname">run_backend</a>(<br>&nbsp;&nbsp;&nbsp;&nbsp;self, <br>&nbsp;&nbsp;&nbsp;&nbsp;backend: <a class="struct" href="https://doc.rust-lang.org/1.60.0/alloc/boxed/struct.Box.html" title="struct alloc::boxed::Box">Box</a>&lt;dyn <a class="trait" href="../handler/trait.VhostUserBackend.html" title="trait devices::virtio::vhost::user::device::handler::VhostUserBackend">VhostUserBackend</a>&gt;, <br>&nbsp;&nbsp;&nbsp;&nbsp;ex: &amp;<a class="enum" href="../../../../../../cros_async/sys/unix/executor/enum.Executor.html" title="enum cros_async::sys::unix::executor::Executor">Executor</a><br>) -&gt; <a class="struct" href="https://doc.rust-lang.org/1.60.0/core/pin/struct.Pin.html" title="struct core::pin::Pin">Pin</a>&lt;<a class="struct" href="https://doc.rust-lang.org/1.60.0/alloc/boxed/struct.Box.html" title="struct alloc::boxed::Box">Box</a>&lt;dyn <a class="trait" href="https://doc.rust-lang.org/1.60.0/core/future/future/trait.Future.html" title="trait core::future::future::Future">Future</a>&lt;Output = <a class="type" href="https://docs.rs/anyhow/1.0.58/anyhow/type.Result.html" title="type anyhow::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.60.0/std/primitive.unit.html">()</a>&gt;&gt;&gt;&gt;</h4></div></summary><div class="docblock"><p>Returns a <code>Future</code> that will process requests from <code>backend</code> when polled. The future exits
when the front-end side disconnects or an error occurs.</p>
</div></details></div><h2 id="provided-methods" class="small-section-header">Provided methods<a href="#provided-methods" class="anchor"></a></h2><div class="methods"><details class="rustdoc-toggle" open><summary><div id="method.take_parent_process_resources" class="method has-srclink"><div class="rightside"><a class="srclink" href="../../../../../../src/devices/virtio/vhost/user/device/listener.rs.html#46-48">source</a></div><h4 class="code-header">fn <a href="#method.take_parent_process_resources" class="fnname">take_parent_process_resources</a>(&amp;mut self) -&gt; <a class="enum" href="https://doc.rust-lang.org/1.60.0/core/option/enum.Option.html" title="enum core::option::Option">Option</a>&lt;<a class="struct" href="https://doc.rust-lang.org/1.60.0/alloc/boxed/struct.Box.html" title="struct alloc::boxed::Box">Box</a>&lt;dyn <a class="trait" href="https://doc.rust-lang.org/1.60.0/core/any/trait.Any.html" title="trait core::any::Any">Any</a>&gt;&gt;</h4></div></summary><div class="docblock"><p>Take and return resources owned by the parent process in case of a incoming fork.</p>
<p>This method needs to be called only if you are going to use the listener in a jailed child
process. In this case, the listener will belong to the child and the parent will drop it,
but the child may lack the rights to drop some resources created at construction time. One
such example is the socket file of a regular vhost-user device, that cannot be dropped by
the child unless it gets extra permissions.</p>
<p>This method returns an opaque object that, upon being dropped, will free these resources.
That way, the child process does not need extra rights to clear them, and the parent can
drop the listener after forking and just need to keep that object alive until the child
exits to do housekeeping properly.</p>
<p>The default implementation returns nothing as that’s what most listeners would need anyway.</p>
</div></details><details class="rustdoc-toggle" open><summary><div id="method.run_device" class="method has-srclink"><div class="rightside"><a class="srclink" href="../../../../../../src/devices/virtio/vhost/user/device/listener.rs.html#60-68">source</a></div><h4 class="code-header">fn <a href="#method.run_device" class="fnname">run_device</a>(self, device: <a class="struct" href="https://doc.rust-lang.org/1.60.0/alloc/boxed/struct.Box.html" title="struct alloc::boxed::Box">Box</a>&lt;dyn <a class="trait" href="../trait.VhostUserDevice.html" title="trait devices::virtio::vhost::user::device::VhostUserDevice">VhostUserDevice</a>&gt;) -&gt; <a class="type" href="https://docs.rs/anyhow/1.0.58/anyhow/type.Result.html" title="type anyhow::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.60.0/std/primitive.unit.html">()</a>&gt; <span class="where fmt-newline">where<br>&nbsp;&nbsp;&nbsp;&nbsp;Self: <a class="trait" href="https://doc.rust-lang.org/1.60.0/core/marker/trait.Sized.html" title="trait core::marker::Sized">Sized</a>,&nbsp;</span></h4></div></summary><div class="docblock"><p>Start processing requests for a <code>VhostUserDevice</code> on <code>listener</code>. Returns when the front-end
side disconnects or an error occurs.</p>
</div></details></div><h2 id="implementors" class="small-section-header">Implementors<a href="#implementors" class="anchor"></a></h2><div class="item-list" id="implementors-list"><section id="impl-VhostUserListenerTrait" class="impl has-srclink"><span class="rightside"><a class="srclink" href="../../../../../../src/devices/virtio/vhost/user/device/listener/sys/unix.rs.html#112-161">source</a></span><a href="#impl-VhostUserListenerTrait" class="anchor"></a><h3 class="code-header in-band">impl <a class="trait" href="trait.VhostUserListenerTrait.html" title="trait devices::virtio::vhost::user::device::listener::VhostUserListenerTrait">VhostUserListenerTrait</a> for <a class="enum" href="sys/unix/enum.VhostUserListener.html" title="enum devices::virtio::vhost::user::device::listener::sys::unix::VhostUserListener">VhostUserListener</a></h3></section></div><script type="text/javascript" src="../../../../../../implementors/devices/virtio/vhost/user/device/listener/trait.VhostUserListenerTrait.js" async></script></section><section id="search" class="content hidden"></section></div></main><div id="rustdoc-vars" data-root-path="../../../../../../" data-current-crate="devices" data-themes="ayu,dark,light" data-resource-suffix="" data-rustdoc-version="1.60.0 (7737e0b5c 2022-04-04)" ></div>
</body></html>
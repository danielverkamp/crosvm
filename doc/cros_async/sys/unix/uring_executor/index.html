<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="`URingExecutor`"><meta name="keywords" content="rust, rustlang, rust-lang, uring_executor"><title>cros_async::sys::unix::uring_executor - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../SourceSerif4-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../FiraSans-Regular.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../FiraSans-Medium.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../SourceCodePro-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../SourceSerif4-Bold.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../SourceCodePro-Semibold.ttf.woff2"><link rel="stylesheet" type="text/css" href="../../../../normalize.css"><link rel="stylesheet" type="text/css" href="../../../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../../../../ayu.css" disabled><link rel="stylesheet" type="text/css" href="../../../../dark.css" disabled><link rel="stylesheet" type="text/css" href="../../../../light.css" id="themeStyle"><script id="default-settings" ></script><script src="../../../../storage.js"></script><script src="../../../../crates.js"></script><script defer src="../../../../main.js"></script>
    <noscript><link rel="stylesheet" href="../../../../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../../../../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../../../../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../../../../favicon.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="sidebar-logo" href="../../../../cros_async/index.html"><div class="logo-container"><img class="rust-logo" src="../../../../rust-logo.svg" alt="logo"></div>
        </a><h2 class="location"></h2>
    </nav>
    <nav class="sidebar"><a class="sidebar-logo" href="../../../../cros_async/index.html"><div class="logo-container"><img class="rust-logo" src="../../../../rust-logo.svg" alt="logo"></div>
        </a><h2 class="location"><a href="#">Module uring_executor</a></h2><div class="sidebar-elems"><section><div class="block"><ul><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#constants">Constants</a></li><li><a href="#statics">Statics</a></li><li><a href="#functions">Functions</a></li><li><a href="#types">Type Definitions</a></li></ul></div></section><div id="sidebar-vars" data-name="uring_executor" data-ty="mod" data-relpath="./"></div><script defer src="./sidebar-items.js"></script></div></nav><main><div class="width-limiter"><div class="sub-container"><a class="sub-logo-container" href="../../../../cros_async/index.html"><img class="rust-logo" src="../../../../rust-logo.svg" alt="logo"></a><nav class="sub"><div class="theme-picker hidden"><button id="theme-picker" aria-label="Pick another theme!" aria-haspopup="menu" title="themes"><img width="22" height="22" alt="Pick another theme!" src="../../../../brush.svg"></button><div id="theme-choices" role="menu"></div></div><form class="search-form"><div class="search-container"><span></span><input class="search-input" name="search" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><button type="button" id="help-button" title="help">?</button><a id="settings-menu" href="../../../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../../../wheel.svg"></a></div></form></nav></div><section id="main-content" class="content"><div class="main-heading">
    <h1 class="fqn"><span class="in-band">Module <a href="../../../index.html">cros_async</a>::<wbr><a href="../../index.html">sys</a>::<wbr><a href="../index.html">unix</a>::<wbr><a class="mod" href="#">uring_executor</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../../../../clipboard.svg" width="19" height="18" alt="Copy item path"></button></span></h1><span class="out-of-band"><a class="srclink" href="../../../../src/cros_async/sys/unix/uring_executor.rs.html#5-1211">source</a> · <a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span></div><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p><code>URingExecutor</code></p>
<p>The executor runs all given futures to completion. Futures register wakers associated with
io_uring operations. A waker is called when the set of uring ops the waker is waiting on
completes.</p>
<p><code>URingExecutor</code> is meant to be used with the <code>futures-rs</code> crate that provides combinators and
utility functions to combine futures. In general, the interface provided by <code>URingExecutor</code>
shouldn’t be used directly. Instead, use them by interacting with implementors of <code>IoSource</code>,
and the high-level future functions.</p>
<h3 id="readwrite-buffer-management"><a href="#readwrite-buffer-management">Read/Write buffer management.</a></h3>
<p>There are two key issues managing asynchronous IO buffers in rust.</p>
<ol>
<li>The kernel has a mutable reference to the memory until the completion is returned. Rust must
not have any references to it during that time.</li>
<li>The memory must remain valid as long as the kernel has a reference to it.</li>
</ol>
<h4 id="the-kernels-mutable-borrow-of-the-buffer"><a href="#the-kernels-mutable-borrow-of-the-buffer">The kernel’s mutable borrow of the buffer</a></h4>
<p>Because the buffers used for read and write must be passed to the kernel for an unknown
duration, the functions must maintain ownership of the memory.  The core of this problem is that
the lifetime of the future isn’t tied to the scope in which the kernel can modify the buffer the
future has a reference to.  The buffer can be modified at any point from submission until the
operation completes. The operation can’t be synchronously canceled when the future is dropped,
and Drop can’t be used for safety guarantees. To ensure this never happens, only memory that
implements <code>BackingMemory</code> is accepted.  For implementors of <code>BackingMemory</code> the mut borrow
isn’t an issue because those are already Ok with external modifications to the memory (Like a
<code>VolatileSlice</code>).</p>
<h4 id="buffer-lifetime"><a href="#buffer-lifetime">Buffer lifetime</a></h4>
<p>What if the kernel’s reference to the buffer outlives the buffer itself?  This could happen if a
read operation was submitted, then the memory is dropped.  To solve this, the executor takes an
Arc to the backing memory. Vecs being read to are also wrapped in an Arc before being passed to
the executor.  The executor holds the Arc and ensures all operations are complete before dropping
it, that guarantees the memory is valid for the duration.</p>
<p>The buffers <em>have</em> to be on the heap. Because we don’t have a way to cancel a future if it is
dropped(can’t rely on drop running), there is no way to ensure the kernel’s buffer remains valid
until the operation completes unless the executor holds an Arc to the memory on the heap.</p>
<h3 id="using-vec-for-readswrites"><a href="#using-vec-for-readswrites">Using <code>Vec</code> for reads/writes.</a></h3>
<p>There is a convenience wrapper <code>VecIoWrapper</code> provided for fully owned vectors. This type
ensures that only the kernel is allowed to access the <code>Vec</code> and wraps the the <code>Vec</code> in an Arc to
ensure it lives long enough.</p>
</div></details><h2 id="structs" class="small-section-header"><a href="#structs">Structs</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.OpData.html" title="cros_async::sys::unix::uring_executor::OpData struct">OpData</a></div><div class="item-right docblock-short"></div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.PendingOperation.html" title="cros_async::sys::unix::uring_executor::PendingOperation struct">PendingOperation</a></div><div class="item-right docblock-short"></div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.RawExecutor.html" title="cros_async::sys::unix::uring_executor::RawExecutor struct">RawExecutor</a></div><div class="item-right docblock-short"></div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.RegisteredSource.html" title="cros_async::sys::unix::uring_executor::RegisteredSource struct">RegisteredSource</a></div><div class="item-right docblock-short"></div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.Ring.html" title="cros_async::sys::unix::uring_executor::Ring struct">Ring</a></div><div class="item-right docblock-short"></div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.URingExecutor.html" title="cros_async::sys::unix::uring_executor::URingExecutor struct">URingExecutor</a></div><div class="item-right docblock-short"><p>An executor that uses io_uring for its asynchronous I/O operations. See the documentation of
<code>Executor</code> for more details about the methods.</p>
</div></div></div><h2 id="enums" class="small-section-header"><a href="#enums">Enums</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.Error.html" title="cros_async::sys::unix::uring_executor::Error enum">Error</a></div><div class="item-right docblock-short"></div></div><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.OpStatus.html" title="cros_async::sys::unix::uring_executor::OpStatus enum">OpStatus</a></div><div class="item-right docblock-short"></div></div></div><h2 id="constants" class="small-section-header"><a href="#constants">Constants</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.NUM_ENTRIES.html" title="cros_async::sys::unix::uring_executor::NUM_ENTRIES constant">NUM_ENTRIES</a></div><div class="item-right docblock-short"></div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.PROCESSING.html" title="cros_async::sys::unix::uring_executor::PROCESSING constant">PROCESSING</a></div><div class="item-right docblock-short"></div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.WAITING.html" title="cros_async::sys::unix::uring_executor::WAITING constant">WAITING</a></div><div class="item-right docblock-short"></div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.WOKEN.html" title="cros_async::sys::unix::uring_executor::WOKEN constant">WOKEN</a></div><div class="item-right docblock-short"></div></div></div><h2 id="statics" class="small-section-header"><a href="#statics">Statics</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="static" href="static.USE_URING.html" title="cros_async::sys::unix::uring_executor::USE_URING static">USE_URING</a></div><div class="item-right docblock-short"></div></div></div><h2 id="functions" class="small-section-header"><a href="#functions">Functions</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.dup_fd.html" title="cros_async::sys::unix::uring_executor::dup_fd fn">dup_fd</a><a title="unsafe function" href="#"><sup>⚠</sup></a></div><div class="item-right docblock-short"></div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.use_uring.html" title="cros_async::sys::unix::uring_executor::use_uring fn">use_uring</a></div><div class="item-right docblock-short"></div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.usize_to_u64.html" title="cros_async::sys::unix::uring_executor::usize_to_u64 fn">usize_to_u64</a></div><div class="item-right docblock-short"></div></div></div><h2 id="types" class="small-section-header"><a href="#types">Type Definitions</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="type" href="type.Result.html" title="cros_async::sys::unix::uring_executor::Result type">Result</a></div><div class="item-right docblock-short"></div></div></div></section><section id="search" class="content hidden"></section></div></main><div id="rustdoc-vars" data-root-path="../../../../" data-current-crate="cros_async" data-themes="ayu,dark,light" data-resource-suffix="" data-rustdoc-version="1.60.0 (7737e0b5c 2022-04-04)" ></div>
</body></html>